# 餐桌选择功能使用说明

## 📋 功能概述
在用户点餐付款时，系统会显示餐桌选择下拉框，用户可以选择自己所在的餐桌，订单将记录餐桌信息。

## 🔧 实现的功能

### 1. 数据库修改
- ✅ 在 `orders` 表中添加了 `canzhuomingcheng` 字段（餐桌名称）
- ✅ 更新了主数据库文件 `cl200442145.sql` 和 `server_code/sql/cl200442145.sql`

### 2. 后端修改
- ✅ 在 `OrdersEntity.java` 中添加了餐桌名称属性及其 getter/setter 方法

### 3. 前端修改

#### 付款确认页面 (`client_code/src/views/pages/shop_order/confirm.vue`)
- ✅ 添加了餐桌选择下拉框
- ✅ 从后端获取空闲餐桌列表
- ✅ 提交订单时验证是否选择了餐桌
- ✅ 将选择的餐桌名称保存到订单中

#### 订单列表页面
- ✅ 管理端订单列表 (`manage_code/src/views/orders/list.vue`) 显示餐桌名称
- ✅ 客户端订单列表 (`client_code/src/views/pages/shop_order/list.vue`) 显示餐桌名称
- ✅ 移除了"地址"、"电话"、"收货人"字段（堂食不需要配送信息）
- ✅ 移除了"折扣价"、"折扣总价格"字段（系统不需要折扣功能）

## 🚀 使用步骤

### 数据库更新
在开始使用前，需要执行以下 SQL 语句更新数据库：

```sql
ALTER TABLE `orders` ADD COLUMN `canzhuomingcheng` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '餐桌名称' AFTER `goodtype`;
```

或者直接重新导入更新后的数据库文件：
- `cl200442145.sql`
- `server_code/sql/cl200442145.sql`

### 用户操作流程

1. **进入点餐页面**
   - 浏览菜品，添加商品到购物车

2. **进入付款确认页面**
   - 系统自动显示已添加的商品
   - 可以填写备注信息
   - **重要：在"选择餐桌"下拉框中选择您所在的餐桌**
   - 下拉框中会显示餐桌名称和位置，例如："1号桌 (大厅西侧)"

3. **确认支付**
   - 点击"余额支付"按钮
   - 如果未选择餐桌，系统会提示："请选择您所在的餐桌"
   - 选择餐桌后才能成功提交订单

4. **查看订单**
   - 在订单列表中可以看到每个订单对应的餐桌名称
   - 商家在管理端也能看到每个订单是哪个餐桌点的

## 📝 注意事项

1. **餐桌筛选**：目前系统只显示状态为"空闲"的餐桌供用户选择
2. **必选项**：选择餐桌是必填项，不选择无法提交订单
3. **显示格式**：下拉框显示格式为"餐桌名称 (餐桌位置)"，方便用户识别
4. **历史订单**：对于没有餐桌信息的历史订单，会显示"未选择"

## 🎯 效果展示

### 付款确认页面
```
┌─────────────────────────────────┐
│        订单提交                  │
├─────────────────────────────────┤
│ [商品清单表格]                   │
├─────────────────────────────────┤
│ 备注                             │
│ [备注输入框]                     │
├─────────────────────────────────┤
│ 选择餐桌                         │
│ [请选择您所在的餐桌 ▼]           │
│  - 1号桌 (大厅西侧)              │
│  - 2号桌 (大厅东侧)              │
│  - 3号桌 (靠窗位置)              │
├─────────────────────────────────┤
│ 总价：￥99.90    [余额支付]      │
└─────────────────────────────────┘
```

### 订单列表
```
订单编号 | 商品名称 | 数量 | 价格 | 备注 | 餐桌名称 | 下单时间 | 订单状态
---------|---------|------|------|------|----------|----------|----------
20251109 | 生腌虾  | 1    | 99.9 | 微辣 | 1号桌    | 18:30:22 | 已支付
```

**注意**：堂食系统已移除"地址"、"电话"、"收货人"等配送相关字段。

## 🔍 技术实现细节

### 获取餐桌列表
```javascript
context.$http.get('cantingxinxi/list', {
    params: {
        page: 1,
        limit: 100,
        canzhuozhuangtai: '空闲' // 只获取空闲的餐桌
    }
})
```

### 提交订单时包含餐桌信息
```javascript
orders.push({
    // ... 其他订单信息
    canzhuomingcheng: selectedCanzhuo.value, // 餐桌名称
    // ...
})
```

## ✅ 完成状态

- [x] 数据库表结构更新
- [x] 后端实体类更新
- [x] 前端付款页面添加餐桌选择
- [x] 前端获取餐桌列表
- [x] 订单提交验证
- [x] 管理端订单列表显示餐桌
- [x] 客户端订单列表显示餐桌
- [x] 移除配送相关字段（地址、电话、收货人）
- [x] 移除折扣相关字段（折扣价、折扣总价格）
- [x] 订单管理"核销"改为"完成订单"
- [x] 客户端订单页面添加"返回首页"按钮

---

**开发日期**: 2025-11-09  
**功能状态**: 已完成 ✅

